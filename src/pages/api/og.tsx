import { ImageResponse } from '@vercel/og';
import { NextRequest } from 'next/server';


export const config = {
  runtime: 'edge',
};

export default function handler(request: NextRequest) {
  try {
    const { searchParams } = new URL(request.url);

    // ?title=<title>
    const hasTitle = searchParams.has('title');
    const title = hasTitle
      ? searchParams.get('title')?.slice(0, 100)
      : 'The Coffee Class';

    return new ImageResponse(
      (
        <div
          style={{
            height: '100%',
            width: '100%',
            display: 'flex',
            textAlign: 'center',
            alignItems: 'center',
            justifyContent: 'center',
            flexDirection: 'column',
            flexWrap: 'nowrap',
            backgroundColor: 'white',
            backgroundImage: 'radial-gradient(circle at 25px 25px, lightgray 2%, transparent 0%), radial-gradient(circle at 75px 75px, lightgray 2%, transparent 0%)',
            backgroundSize: '100px 100px',
          }}
        >
          <div
            style={{
              display: 'flex',
              alignItems: 'center',
              justifyContent: 'center',
              width: 'auto',
              height: 'auto'
            }}
          >
            <svg version="1.0" xmlns="http://www.w3.org/2000/svg" width="300.000000pt" height="300.000000pt" viewBox="0 0 300.000000 300.000000" preserveAspectRatio="xMidYMid meet">  <g transform="translate(0.000000,300.000000) scale(0.100000,-0.100000)" fill="#000000" stroke="none"> <path d="M1087 1897 c-53 -17 -106 -63 -128 -111 -16 -36 -19 -68 -19 -257 0 -207 1 -218 23 -260 66 -125 235 -145 331 -39 53 59 58 89 54 327 l-3 211 -30 44 c-53 75 -149 111 -228 85z m151 -57 c23 -16 49 -44 57 -61 18 -34 30 -154 20 -206 l-6 -31 -26 24 c-14 13 -32 24 -40 24 -10 0 -12 6 -7 23 8 24 8 35 -2 87 -10 53 -18 58 -90 56 -55 -2 -69 -6 -84 -24 -15 -18 -17 -29 -9 -55 14 -50 11 -87 -7 -87 -9 0 -28 -9 -42 -21 l-27 -21 -3 91 c-2 80 0 96 23 140 31 62 78 90 151 91 41 0 59 -6 92 -30z m-141 -122 c-4 -12 -2 -28 4 -34 14 -17 7 -76 -10 -82 -10 -3 -11 3 -6 27 4 20 2 37 -5 46 -14 17 -5 65 11 65 7 0 9 -9 6 -22z m57 -2 c-3 -13 -1 -33 5 -44 7 -14 8 -29 1 -46 -13 -35 -31 -33 -24 3 3 16 1 37 -4 48 -14 25 -4 63 14 63 10 0 13 -7 8 -24z m50 -1 c-3 -14 -1 -32 6 -40 12 -15 5 -75 -9 -75 -16 0 -20 13 -10 32 8 14 8 23 0 31 -12 12 -15 60 -4 70 14 15 23 6 17 -18z m72 -179 c7 -30 -12 -103 -37 -137 -10 -15 -19 -34 -19 -43 0 -14 -11 -16 -77 -14 -60 2 -77 6 -75 17 2 7 -4 21 -12 30 -35 38 -60 144 -39 164 3 4 62 7 129 7 122 0 124 0 130 -24z m-260 -144 c41 -77 48 -82 127 -82 68 0 107 15 107 43 0 5 8 21 19 35 10 15 23 41 28 57 10 30 10 29 17 -20 18 -125 -41 -214 -150 -231 -55 -8 -122 21 -159 70 -22 29 -29 50 -33 106 -5 69 6 128 16 86 2 -10 15 -39 28 -64z" /> <path d="M1616 1873 c-3 -3 -6 -44 -6 -90 0 -66 3 -83 14 -83 11 0 16 14 18 48 3 39 6 47 23 47 17 0 20 -8 23 -48 4 -60 26 -59 30 1 5 67 -31 105 -66 70 -9 -9 -12 -5 -12 19 0 31 -11 48 -24 36z" /> <path d="M1456 1863 c-13 -13 -5 -23 19 -23 23 0 24 -3 27 -67 2 -53 6 -68 18 -68 12 0 14 13 12 67 -4 65 -3 67 22 70 15 2 27 8 26 13 0 11 -114 18 -124 8z" /> <path d="M1768 1813 c-24 -28 -29 -53 -16 -76 15 -29 27 -37 59 -37 24 0 64 29 43 31 -5 0 -24 1 -43 2 -19 1 -36 8 -39 15 -3 10 6 13 39 11 36 -3 44 0 47 14 5 24 -26 57 -53 57 -12 0 -29 -8 -37 -17z m62 -23 c0 -5 -14 -10 -31 -10 -17 0 -28 4 -24 10 3 6 17 10 31 10 13 0 24 -4 24 -10z" /> <path d="M1798 1629 c-10 -5 -18 -17 -18 -25 0 -8 -7 -17 -15 -20 -19 -8 -19 -24 0 -24 11 0 14 -11 12 -46 -1 -30 2 -48 11 -51 8 -3 12 10 12 46 0 44 3 51 20 51 11 0 20 5 20 10 0 6 -9 10 -20 10 -26 0 -26 20 0 27 12 3 19 10 17 16 -5 16 -20 18 -39 6z" /> <path d="M1898 1629 c-10 -5 -18 -17 -18 -25 0 -8 -7 -17 -15 -20 -20 -8 -19 -24 1 -24 12 0 15 -10 13 -47 -3 -37 0 -48 11 -48 12 0 14 11 12 48 -3 42 -1 47 17 47 12 0 21 5 21 10 0 6 -9 10 -21 10 -27 0 -19 24 9 28 26 4 29 17 6 26 -19 7 -15 8 -36 -5z" /> <path d="M1502 1620 c-27 -11 -51 -62 -44 -96 9 -50 93 -85 121 -51 15 19 4 27 -30 20 -38 -7 -59 11 -59 53 0 38 27 59 65 50 30 -8 42 10 16 23 -23 13 -38 13 -69 1z" /> <path d="M1621 1564 c-12 -15 -21 -32 -21 -39 0 -24 41 -65 66 -65 31 0 64 33 64 65 0 32 -33 65 -64 65 -15 0 -33 -11 -45 -26z m74 -39 c0 -25 -4 -31 -27 -33 -19 -2 -28 2 -33 18 -8 27 12 52 39 48 16 -2 21 -10 21 -33z" /> <path d="M1971 1564 c-26 -33 -27 -58 -1 -84 20 -20 45 -25 74 -14 29 11 17 29 -21 29 -21 0 -38 5 -41 13 -3 10 6 13 39 11 39 -3 44 -1 47 18 3 23 -30 53 -59 53 -10 0 -27 -12 -38 -26z" /> <path d="M2117 1578 c-9 -7 -20 -27 -23 -44 -10 -51 39 -88 90 -68 31 12 17 31 -20 30 -23 -1 -39 4 -42 12 -3 10 6 13 39 11 51 -4 63 17 30 50 -24 24 -50 27 -74 9z" /> <path d="M1614 1387 c-10 -27 1 -160 14 -165 9 -3 12 18 12 82 0 78 -12 118 -26 83z" /> <path d="M1502 1380 c-27 -11 -51 -62 -44 -96 9 -50 93 -85 121 -51 15 19 4 27 -30 20 -38 -7 -59 11 -59 53 0 38 26 58 64 48 30 -7 43 12 17 25 -23 13 -38 13 -69 1z" /> <path d="M1689 1329 c-23 -23 -25 -57 -4 -87 13 -17 24 -21 60 -20 l45 2 0 61 0 61 -41 1 c-28 1 -46 -4 -60 -18z m72 -25 c17 -21 0 -49 -32 -49 -24 0 -36 23 -25 51 7 19 40 18 57 -2z" /> <path d="M1835 1336 c-24 -18 -13 -45 25 -59 17 -6 30 -15 30 -19 0 -15 -20 -19 -41 -8 -26 14 -36 6 -19 -15 16 -20 54 -19 75 1 21 21 15 35 -21 54 -16 8 -31 16 -33 18 -3 1 1 8 7 14 9 9 15 9 24 0 16 -16 28 -15 28 2 0 26 -45 34 -75 12z" /> <path d="M1952 1338 c-23 -23 -13 -47 25 -63 28 -12 34 -18 25 -27 -10 -10 -17 -10 -33 0 -27 17 -48 4 -24 -15 37 -27 85 -10 85 30 0 11 -11 22 -30 28 -16 6 -30 17 -30 25 0 17 5 17 32 3 25 -13 35 -5 18 16 -15 18 -51 20 -68 3z" /> </g> </svg>
          </div>
          <div
            style={{
              display: 'flex',
              fontSize: 40,
              fontStyle: 'normal',
              color: 'black',
              marginTop: 30,
              lineHeight: 1.8,
              whiteSpace: 'pre-wrap',
            }}
          >
            <b>{title}</b>
          </div>
        </div>
      ),
      {
        width: 1200,
        height: 630,
      },
    );
  } catch (e: any) {
    console.log(`${e.message}`);
    return new Response(`Failed to generate the image`, {
      status: 500,
    });
  }
}